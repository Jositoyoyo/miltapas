{% extends 'base.html.twig' %}

{% block body %}
    <input id="keys" type="text" value="" placeholder="Nombre del local">
    <div id="content"></div>
    <input id="direccion" type="text" value="" placeholder="direccion del local">
    <button id="mostrar_direccion">mostrar</button>
    <button id="my_position">Donde estoy</button>
    <input id="coordenadas" type="text" value="" placeholder="coordenadas del local">
    <ul>
        <li>
            <a href="{{ path('local_index') }}">Back to the list</a>
        </li>
    </ul>
{% endblock %}
{% block scripts %}
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true"></script>    
    <script>
        $(window).load(function () {
            $('#keys').keyup(function () {
                var keys = $(this).val();
                var dataString = "keys=" + keys;
                console.log(dataString);
                $.ajax({
                    url: "http://localhost:8000/localajax/buscar_local",
                    async: true,
                    type: "POST",
                    data: dataString,
                    statusCode: {
                        404: function () {
                            console.log("page not found");
                        },
                        200: function () {
                            console.log("page found");
                        }
                    },
                })
                        .done(function (data) {
                            //$(data).replaceAll('#content');
                            $('#content').fadeIn(500).html(data);
                            $('.suggest-element').bind('click', function () {

                                var id = $(this).attr('id');

                                $('#keys').val($('#' + id).attr('data'));
                                $('#content').fadeOut(500);


                            });
                        })
                        .fail(function () {
                            console.log("Fails, error");
                        })
                        .always(function () {
                            console.log("complete Ajax");
                        });
            });

            $("#mostrar_direccion").click(function () {
                var address = document.getElementById("direccion").value;
                console.log(address);
                geocoder = new google.maps.Geocoder();
                geocoder.geocode({'address': address}, function (results, status) {
                    if (status == google.maps.GeocoderStatus.OK) {
                        var latLng = results[0].geometry.location;
                        console.log(latLng);
                        document.getElementById("coordenadas").value = latLng;
                    } else {
                        alert('Geocode was not successful for the following reason: ' + status);
                    }
                });

            });
        });
    </script>
{% endblock %}
